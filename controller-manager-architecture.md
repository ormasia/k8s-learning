# Controller Manager æ¶æ„è§£æ

## ğŸ—ï¸ åŒç»„ä»¶æ¶æ„è®¾è®¡

### 1. kube-controller-managerï¼ˆæ ¸å¿ƒæ§åˆ¶å™¨ç®¡ç†å™¨ï¼‰

**èŒè´£èŒƒå›´ï¼š**
- **æ ¸å¿ƒ Kubernetes æ§åˆ¶å™¨**
- **å¹³å°æ— å…³çš„æ§åˆ¶é€»è¾‘**

**åŒ…å«çš„æ§åˆ¶å™¨ï¼š**
```yaml
æ ¸å¿ƒæ§åˆ¶å™¨:
  - ReplicaSet Controller      # ç®¡ç† ReplicaSet
  - Deployment Controller      # ç®¡ç† Deployment
  - StatefulSet Controller     # ç®¡ç† StatefulSet
  - DaemonSet Controller       # ç®¡ç† DaemonSet
  - Job Controller             # ç®¡ç† Job
  - CronJob Controller         # ç®¡ç† CronJob
  - Namespace Controller       # ç®¡ç† Namespace ç”Ÿå‘½å‘¨æœŸ
  - ServiceAccount Controller  # ç®¡ç† ServiceAccount
  - Token Controller           # ç®¡ç† ServiceAccount Token
  - Node Controller           # ç®¡ç†èŠ‚ç‚¹çŠ¶æ€ï¼ˆéäº‘ç›¸å…³éƒ¨åˆ†ï¼‰
  - PersistentVolume Controller # ç®¡ç† PV/PVCï¼ˆéäº‘ç›¸å…³éƒ¨åˆ†ï¼‰
  - Endpoint Controller        # ç®¡ç† Endpoints
  - Service Controller         # ç®¡ç† Serviceï¼ˆéäº‘ç›¸å…³éƒ¨åˆ†ï¼‰
```

### 2. cloud-controller-managerï¼ˆäº‘æ§åˆ¶å™¨ç®¡ç†å™¨ï¼‰

**èŒè´£èŒƒå›´ï¼š**
- **äº‘å‚å•†ç‰¹å®šçš„æ§åˆ¶å™¨**
- **ä¸äº‘åŸºç¡€è®¾æ–½äº¤äº’**

**åŒ…å«çš„æ§åˆ¶å™¨ï¼š**
```yaml
äº‘ç›¸å…³æ§åˆ¶å™¨:
  - Node Controller          # äº‘èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸç®¡ç†
    - æ£€æŸ¥äº‘èŠ‚ç‚¹æ˜¯å¦å·²åˆ é™¤
    - è®¾ç½®èŠ‚ç‚¹çš„äº‘ç‰¹å®šæ ‡ç­¾
    - è·å–èŠ‚ç‚¹åœ°å€ä¿¡æ¯
  
  - Route Controller         # äº‘è·¯ç”±ç®¡ç†
    - åœ¨äº‘åŸºç¡€è®¾æ–½ä¸­é…ç½®è·¯ç”±
    - ç®¡ç† pod ç½‘ç»œè·¯ç”±
  
  - Service Controller       # äº‘è´Ÿè½½å‡è¡¡å™¨
    - ä¸º LoadBalancer ç±»å‹çš„ Service åˆ›å»ºäº‘ LB
    - ç®¡ç†äº‘è´Ÿè½½å‡è¡¡å™¨ç”Ÿå‘½å‘¨æœŸ
  
  - Volume Controller        # äº‘å­˜å‚¨ç®¡ç†
    - ç®¡ç†äº‘å­˜å‚¨å·çš„æŒ‚è½½/å¸è½½
    - å¤„ç†äº‘å­˜å‚¨çš„åŠ¨æ€é¢„é…
```

## ğŸ”„ æ¶æ„æ¼”è¿›å†ç¨‹

### ä¼ ç»Ÿæ¶æ„ï¼ˆv1.5 åŠä¹‹å‰ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       kube-controller-manager       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     æ ¸å¿ƒæ§åˆ¶å™¨                â”‚  â”‚
â”‚  â”‚  + äº‘å‚å•†ç‰¹å®šæ§åˆ¶å™¨           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜ï¼š**
- äº‘å‚å•†ä»£ç è€¦åˆåœ¨æ ¸å¿ƒä»£ç ä¸­
- å‘å¸ƒå‘¨æœŸç»‘å®š
- ç»´æŠ¤å¤æ‚æ€§é«˜
- ä¸åŒäº‘å‚å•†éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç 

### ç°ä»£æ¶æ„ï¼ˆv1.6+ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    kube-controller-manager      â”‚  â”‚   cloud-controller-manager     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      æ ¸å¿ƒæ§åˆ¶å™¨           â”‚  â”‚  â”‚  â”‚    äº‘å‚å•†ç‰¹å®šæ§åˆ¶å™¨       â”‚  â”‚
â”‚  â”‚  - ReplicaSet            â”‚  â”‚  â”‚  â”‚  - Node (äº‘éƒ¨åˆ†)          â”‚  â”‚
â”‚  â”‚  - Deployment            â”‚  â”‚  â”‚  â”‚  - Route                  â”‚  â”‚
â”‚  â”‚  - Service (æ ¸å¿ƒéƒ¨åˆ†)    â”‚  â”‚  â”‚  â”‚  - Service (äº‘ LB)        â”‚  â”‚
â”‚  â”‚  - Node (æ ¸å¿ƒéƒ¨åˆ†)       â”‚  â”‚  â”‚  â”‚  - Volume (äº‘å­˜å‚¨)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ‹†åˆ†çš„ä¼˜åŠ¿

### 1. **è§£è€¦åˆ**
```bash
# æ ¸å¿ƒ Kubernetes åŠŸèƒ½ç‹¬ç«‹å‘å¸ƒ
# äº‘å‚å•†åŠŸèƒ½ç‹¬ç«‹å‘å¸ƒå’Œç»´æŠ¤
```

### 2. **å¯æ‰©å±•æ€§**
```yaml
äº‘å‚å•†æ”¯æŒ:
  AWS: aws-cloud-controller-manager
  Azure: azure-cloud-controller-manager  
  GCP: gcp-cloud-controller-manager
  é˜¿é‡Œäº‘: alicloud-controller-manager
  è…¾è®¯äº‘: tencentcloud-controller-manager
```

### 3. **ç»´æŠ¤æ€§**
- äº‘å‚å•†è‡ªä¸»ç»´æŠ¤å„è‡ªçš„ CCM
- æ ¸å¿ƒå›¢é˜Ÿä¸“æ³¨ Kubernetes æ ¸å¿ƒåŠŸèƒ½
- å‡å°‘æ ¸å¿ƒä»£ç çš„å¤æ‚æ€§

## ğŸ”§ å®é™…éƒ¨ç½²ç¤ºä¾‹

### åœ¨äº‘ç¯å¢ƒä¸­çš„éƒ¨ç½²ï¼š
```yaml
# kube-controller-manager å¯åŠ¨å‚æ•°
--controllers=*,bootstrapsigner,tokencleaner
--cloud-provider=external  # å…³é”®ï¼šæŒ‡å®šä½¿ç”¨å¤–éƒ¨äº‘æä¾›å•†

# cloud-controller-manager å•ç‹¬éƒ¨ç½²
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cloud-controller-manager
  namespace: kube-system
spec:
  template:
    spec:
      containers:
      - name: cloud-controller-manager
        image: k8s.gcr.io/cloud-controller-manager:v1.27.3
        command:
        - /usr/local/bin/cloud-controller-manager
        - --cloud-provider=aws  # æˆ–å…¶ä»–äº‘å‚å•†
        - --leader-elect=true
```

## ğŸ“Š å½“å‰é›†ç¾¤åˆ†æ

åŸºäºä½ çš„ kind é›†ç¾¤é…ç½®ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š
- åªè¿è¡Œ `kube-controller-manager`
- æ²¡æœ‰ `cloud-controller-manager`ï¼ˆå› ä¸º kind æ˜¯æœ¬åœ°ç¯å¢ƒï¼‰
- å‚æ•°ä¸­æ²¡æœ‰ `--cloud-provider=external`

è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸º kind é›†ç¾¤æ¨¡æ‹Ÿçš„æ˜¯æœ¬åœ°ç¯å¢ƒï¼Œä¸éœ€è¦äº‘å‚å•†ç‰¹å®šçš„åŠŸèƒ½ã€‚